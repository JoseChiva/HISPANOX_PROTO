#<AdxTL>@(#)0.0.0.0 $Revision$
##MRR - 20/03/2020 GAP VTAS023 Nuevos campos ficha clientes
##MRR01 - 24/09/2020 intranet.
# 6.358.754 ML 19/07/2022 Modifica condición de pago de pedidos y entregas
#06.364.489 AMG.31/08/2022 ERROR SII nº 4111 (CONTROL TIPO DOCUMENTO PARA EVITAR ERRORES EN EL SII)
#06.361.907 :  Modificación informe vencimientos hx - reclamaciones
#######################################################################################
$ACTION

Case ACTION
  When "OUVRE"     :  Gosub OUVRE
  When "SETBOUT"   :  Gosub SETBOUT
  When "APRES_CRE" :  Gosub APRES_MOD
  When "APRES_MOD" :  Gosub APRES_MOD
  When "EXEBOUT"   :  Gosub EXEBOUT # 6.358.754
 When Default
Endcase
Return

##############################################################
######################    ACCIONES    ########################
##############################################################
##############################################################
$EXEBOUT
Case BOUT
  When "8" : Gosub UPD_PTE # 6.358.754

Endcase

Return

$APRES_MOD
#AMG.STR ini

If val(func AFNC.PARAM("ZFICHINTRA","")) = 2 Then
  Call ZSGAACC([M:BPC0]BPCNUM) From ZSGAACC
  Call CLIENTES([F:BPC]BPCNUM) From ZBPCINTRANET
Endif

#Affzo[M:BPRC]
#AMG.END fin
Return

##############################################################
$OUVRE
If !clalev([F:ZTXC]) : Local File TEXCLOB     [ZTXC] : Endif
#06.361.907.ini
If !clalev([F:ZDP]): Local File ZDIFDIAP: Endif
#06.361.907.fin
Return

######################################################################################
$SETBOUT
If [M:BPRC]ZWEB <> 2 Then
 Diszo [M:BPRC]ZEMAIL
 Affzo [M:BPRC]ZEMAIL
Else
 Actzo [M:BPRC]ZEMAIL
 Affzo [M:BPRC]ZEMAIL
Endif
#06.361.907.ini
Filter [ZDP] Where BPC=[M:BPC0]BPCNUM
Read [ZDP] First
  If !fstat
    [M:BPC3]ZDDF=[ZDP]DDIF
    Affzo [M:BPC3]ZDDF
  Endif
Filter [ZDP]
#06.361.907.fin
Return

######################################################################################
# 6.358.754.ini
$UPD_PTE
Local Integer RESP: Raz RESP
Qstbox "¿Desea modificar la condición de pago de los documentos en curso?" Using RESP
If RESP=1
  If !clalev([F:ZSOH]) : Local File SORDER     [ZSOH] : Endif
  If !clalev([F:ZSDH]) : Local File SDELIVERY     [ZSDH] : Endif
  If !clalev([F:ZSQH]) : Local File SQUOTE     [ZSQH] : Endif
  Update [F:ZSOH] Where [F:ZSOH]BPCINV = [M:BPC0]BPCNUM and [F:ZSOH]ORDSTA<>2 With [F:ZSOH]PTE=[M:BPC3]PTE
  Update [F:ZSDH] Where [F:ZSDH]BPCINV = [M:BPC0]BPCNUM and [F:ZSDH]INVFLG<>2 With [F:ZSDH]PTE=[M:BPC3]PTE
  Update [F:ZSQH] Where [F:ZSQH]BPCORD = [M:BPC0]BPCNUM and [F:ZSQH]QUOSTA <3 With [F:ZSQH]PTE=[M:BPC3]PTE
  Infbox "Condición de Pago, actualización finalizada"
Endif
Return
# 6.358.754.fin
##############################################################
######################    ETIQUETAS    #######################
##############################################################

##############################################################
#################    ACCIONES DE CAMPO    ####################
##############################################################
######################################################################################
## Etiqueta añadida por el supervisor (pantalla BPC4) 16/06/2020 11:47:16 (MLGA)
######################################################################################
Subprog AV_ZCLPRPTEX(VALEUR)
Variable Clbfile VALEUR
VALEUR=''
If  [F:BPD]PRPTEX<>''
  Read [ZTXC]TXC1='';'';[F:BPD]PRPTEX
  If !fstat
    VALEUR=func F_RTF2TEXT([F:ZTXC]TEXTE)
  Endif
Endif
End

Subprog AV_ZCLDLVTEX(VALEUR)
Variable Clbfile VALEUR
VALEUR=''
If [F:BPD]DLVTEX<>''
  Read [ZTXC]TXC1='';'';[F:BPD]DLVTEX
  If !fstat
    VALEUR=func F_RTF2TEXT([F:ZTXC]TEXTE)
  Endif
Endif
End

######################################################################################
## Después del campo 'Familia estadística' (pantalla BPC2) 19/07/2021 09:35:14 (ADEV)
######################################################################################
Subprog AP_TSCCOD(VALEUR)
Variable Char    VALEUR()
  If indice = 3 and VALEUR = "" Then
    Call ERRTIT('Campo obligatorio','Error en campo "Clase Oferta Cliente"') From GESECRAN
    mkstat=2
  Endif
End

######################################################################################
## Después de modificar el campo 'Control crédito' (pantalla BPC2) 07/12/2021 18:18:45 (ADEV)
######################################################################################
Subprog AM_OSTCTL(VALEUR)
Variable Integer VALEUR
  If VALEUR = 3 Then
    Actzo [M:BPC2]ZMOTIVOBLOQ
  Else
    [M:BPC2]ZMOTIVOBLOQ = 1
    Affzo [M:BPC2]ZMOTIVOBLOQ
    Diszo [M:BPC2]ZMOTIVOBLOQ
  Endif
End

##############################################################
##################    FUNCIONES PROPIAS    ###################
##############################################################
######################################################################################
Funprog F_RTF2TEXT(CLOB)
Variable Clbfile CLOB

    Local Integer LENTXMT : LENTXMT = 250
    Local Integer NRIGHE : NRIGHE = 4            # 4 = 250x4 char

    Local Char XOUT(LENTXMT)(NRIGHE)

    Call S_RTF2TEXT(LENTXMT,CLOB,XOUT,NRIGHE)

   #Concatenate the row with plain text, by removing the empty space
    Local Char XRET(250) : Raz XRET
    For XI = 0 To NRIGHE
       XRET += vireblc(XOUT(XI),2)
    Next

End XRET




###############################################################################
#                            CORE PROCEDURES
#
# Author: Matteo Carminati (mcarminati@ma-tica.it)
#
# This program is free software; you can redistribute it and/or modify it
# under the terms version 3 of the GNU General Public License as published
# by the Free Software Foundation. This program is distributed in the hope
# that it will be useful, but WITHOUT ANY WARRANTY; without even the implied
# warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
# See the GNU General Public License for more details.
#
###############################################################################

Subprog S_RTF2TEXT(PLENRIGAOUT,CLOB,PTXTOUT,PNRIGEOUT)
Value Integer PLENRIGAOUT
Variable Clbfile CLOB
Variable Char PTXTOUT
Variable Integer PNRIGEOUT

    Local Integer XRIGHE
    Local Integer XNOL
    Local Integer XNCH
    Local Char XCH(1)
    Local Char XCHPREV(1)
    Local Integer XSTRTAG1 : XSTRTAG1 = 0
    Local Integer XSTRTAG2 : XSTRTAG2 = 0

    Local Integer LENGHT : LENGHT = len(CLOB)
    Local Integer CLOTAI : CLOTAI = int(LENGHT/GCLOLNG)+1

    Local  Char    PRTFIN   (GCLOLNG)(CLOTAI)

    Setlob PRTFIN With CLOB


    XRIGHE = dim(PRTFIN,1)

    Local Char XOUT(250)(XRIGHE)
    Local Integer XOUTRLEN(XRIGHE)
    Local Char RIGA(250)
    Local Integer XESCAPE



    #Toglie i tag RTF

    For XNOL = 0 To XRIGHE - 1
        Raz RIGA
        RIGA = PRTFIN(XNOL)


        XOUTRLEN(XNOL) = 0
        For XNCH = 1 To len(RIGA)
            XCHPREV = XCH

            XCH = mid$(RIGA,XNCH,1)
            If XCH = "\" Then
                XESCAPE = -1
                                If func F_GETNEXTCHR(PRTFIN,1,XNCH,XNOL,XRIGHE)= "}" Then
                    XCHPREV = XCH
                    XNCH = XNCH + 1
                    XCH = "}"
                    XESCAPE = 1
                Elsif func F_GETNEXTCHR(PRTFIN,1,XNCH,XNOL,XRIGHE)= "{" Then
                    XCHPREV = XCH
                    XNCH = XNCH + 1
                    XCH = "{"
                    XESCAPE = 1
                Elsif func F_GETNEXTCHR(PRTFIN,4,XNCH,XNOL,XRIGHE)= "pard" Then
                    XNCH = XNCH + 4
                    XCH = " "
                    XESCAPE = 1
                Elsif func F_GETNEXTCHR(PRTFIN,3,XNCH,XNOL,XRIGHE)= "par" Then
                    XNCH = XNCH + 3
                    XCH = " "
                    XESCAPE = 1
                Elsif func F_GETNEXTCHR(PRTFIN,2,XNCH,XNOL,XRIGHE)= "fs" Then   #Font size
                    XNCH = XNCH + 2
                    XCH = ""
                    XESCAPE = -1
                Else
                  Case func F_GETNEXTCHR(PRTFIN,3,XNCH,XNOL,XRIGHE)
                        When "'80" : XCH ="â?¬" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'82" : XCH ="â??" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'83" : XCH ="Æ?" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'84" : XCH ="â??" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'85" : XCH ="â?¦" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'86" : XCH ="â? " : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'87" : XCH ="â?¡" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'88" : XCH ="Ë?" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'89" : XCH ="â?°" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'8a" : XCH ="Å " : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'8b" : XCH ="â?¹" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'8c" : XCH ="Å?" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'8e" : XCH ="Å½" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'91" : XCH ="â??" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'92" : XCH ="â??" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'93" : XCH ="â??" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'94" : XCH ="â??" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'95" : XCH ="â?¢" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'96" : XCH ="â??" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'97" : XCH ="â??" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'98" : XCH ="Ë?" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'99" : XCH ="â?¢" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'9a" : XCH ="Å¡" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'9b" : XCH ="â?º" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'9c" : XCH ="Å?" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'9e" : XCH ="Å¾" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'9f" : XCH ="Å¸" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'a0" : XCH =" " : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'a1" : XCH ="Â¡" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'a2" : XCH ="Â¢" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'a3" : XCH ="Â£" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'a4" : XCH ="Â¤" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'a5" : XCH ="Â¥" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'a6" : XCH ="Â¦" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'a7" : XCH ="Â§" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'a8" : XCH ="Â¨" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'a9" : XCH ="Â©" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'aa" : XCH ="Âª" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'ab" : XCH ="Â«" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'ac" : XCH ="Â¬" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'ad" : XCH =" " : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'ae" : XCH ="Â®" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'af" : XCH ="Â¯" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'b0" : XCH ="Â°" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'b1" : XCH ="Â±" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'b2" : XCH ="Â²" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'b3" : XCH ="Â³" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'b4" : XCH ="Â´" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'b5" : XCH ="Âµ" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'b6" : XCH ="Â¶" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'b7" : XCH ="Â·" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'b8" : XCH ="Â¸" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'b9" : XCH ="Â¹" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'ba" : XCH ="Âº" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'bb" : XCH ="Â»" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'bc" : XCH ="Â¼" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'bd" : XCH ="Â½" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'be" : XCH ="Â¾" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'bf" : XCH ="Â¿" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'c0" : XCH ="Ã?" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'c1" : XCH ="Ã?" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'c2" : XCH ="Ã?" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'c3" : XCH ="Ã?" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'c4" : XCH ="Ã?" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'c5" : XCH ="Ã?" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'c6" : XCH ="Ã?" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'c7" : XCH ="Ã?" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'c8" : XCH ="Ã?" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'c9" : XCH ="Ã?" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'ca" : XCH ="Ã?" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'cb" : XCH ="Ã?" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'cc" : XCH ="Ã?" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'cd" : XCH ="Ã?" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'ce" : XCH ="Ã?" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'cf" : XCH ="Ã?" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'d0" : XCH ="Ã?" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'d1" : XCH ="Ã?" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'d2" : XCH ="Ã?" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'d3" : XCH ="Ã?" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'d4" : XCH ="Ã?" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'d5" : XCH ="Ã?" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'d6" : XCH ="Ã?" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'d7" : XCH ="Ã?" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'d8" : XCH ="Ã?" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'d9" : XCH ="Ã?" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'da" : XCH ="Ã?" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'db" : XCH ="Ã?" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'dc" : XCH ="Ã?" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'dd" : XCH ="Ã?" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'de" : XCH ="Ã?" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'df" : XCH ="Ã?" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'e0" : XCH ="Ã " : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'e1" : XCH ="Ã¡" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'e2" : XCH ="Ã¢" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'e3" : XCH ="Ã£" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'e4" : XCH ="Ã¤" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'e5" : XCH ="Ã¥" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'e6" : XCH ="Ã¦" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'e7" : XCH ="Ã§" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'e8" : XCH ="Ã¨" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'e9" : XCH ="Ã©" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'ea" : XCH ="Ãª" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'eb" : XCH ="Ã«" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'ec" : XCH ="Ã¬" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'ed" : XCH ="Ã­" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'ee" : XCH ="Ã®" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'ef" : XCH ="Ã¯" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'f0" : XCH ="Ã°" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'f1" : XCH ="Ã±" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'f2" : XCH ="Ã²" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'f3" : XCH ="Ã³" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'f4" : XCH ="Ã´" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'f5" : XCH ="Ãµ" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'f6" : XCH ="Ã¶" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'f7" : XCH ="Ã·" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'f8" : XCH ="Ã¸" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'f9" : XCH ="Ã¹" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'fa" : XCH ="Ãº" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'fb" : XCH ="Ã»" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'fc" : XCH ="Ã¼" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'fd" : XCH ="Ã½" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'fe" : XCH ="Ã¾" : XNCH = XNCH + 3 : XESCAPE = 1
                        When "'ff" : XCH ="Ã¿" : XNCH = XNCH + 3 : XESCAPE = 1

                    Endcase
                Endif

                If XESCAPE = -1 Then
                        XSTRTAG1 = 1
                        XNCH = XNCH + 1
                Endif

            Endif

            If XCH = "{" and XCHPREV <> "\" Then XSTRTAG2 = XSTRTAG2 + 1 : Endif

            If XSTRTAG1 = 0 and XSTRTAG2 <= 1  Then
                XOUT(XNOL) += XCH
                XOUTRLEN(XNOL) += 1
            Endif
            If XCH = " " or find(func F_GETNEXTCHR(PRTFIN,2,XNCH-1,XNOL,XRIGHE) ,'\}','\{','\\') > 0 Then XSTRTAG1 = 0 : Endif
            If XCH = "}" and XCHPREV <> "\" Then XSTRTAG2 = XSTRTAG2 - 1 : Endif
        Next
    Next


    Local Integer XNOL2
    Local Integer XCONTA2

    XNOL2 = 0
    XCONTA2 = PLENRIGAOUT
    For XNOL = 0 To XRIGHE - 1
        Raz RIGA
        RIGA = XOUT(XNOL)
        If XNOL = XRIGHE : RIGA = vireblc(RIGA,1) : Endif
        If len(RIGA) > 0 Then
            For XNCH = 1 To len(RIGA)
                XCH = mid$(RIGA,XNCH,1)
                If XCH = chr$(13) Then
                    XCH = " "
                    If func F_GETNEXTCHR(XOUT,1,XNCH,XNOL,XRIGHE)= chr$(10) Then
                        XNCH = XNCH + 1
                    Endif
                Endif
                If XCH = chr$(10) Then
                    XCH = " "
                    If func F_GETNEXTCHR(XOUT,1,XNCH,XNOL,XRIGHE)= chr$(13) Then
                        XNCH = XNCH + 1
                    Endif
                Endif
                If XNCH = 1 and XNOL = 0 and XCH = "{" Then XCH = "" : Endif
                PNRIGEOUT = XNOL2 + 1
                PTXTOUT(XNOL2) += XCH
                XCONTA2 = XCONTA2 - 1
                If XCONTA2 = 0 Then
                    XNOL2 = XNOL2 + 1
                    XCONTA2 = PLENRIGAOUT
                Endif
            Next
        Endif
    Next

    #tolgo la graffa finale
    RIGA = vireblc(PTXTOUT(XNOL2),1)
    If mid$(RIGA,len(RIGA),1) = "}" Then
        PTXTOUT(XNOL2) =  mid$(RIGA,1,len(RIGA)-1)
    Endif


End

############################
Funprog F_GETNEXTCHR(PARRIN,NCHNEXT,NCURPOS,NCURNOL,NTOTRIGHE)
Value Char PARRIN
Value Integer NCHNEXT
Value Integer NCURPOS
Value Integer NCURNOL
Value Integer NTOTRIGHE

    Local Char XRET(NCHNEXT) : XRET = ""

    Local Integer XNCH
    Local Char RIGA(250)
    Local Integer XCONTA

    For XNOL = NCURNOL To NTOTRIGHE - 1
        RIGA = PARRIN(NCURNOL)
        For XNCH = NCURPOS + 1 To len(RIGA) - 1
            XRET += mid$(RIGA,XNCH,1)
            XCONTA += 1
            If XCONTA = NCHNEXT Then
                Break
            Endif
        Next
        If XCONTA = NCHNEXT Then
            Break
        Endif
        NCURPOS = 0
    Next
End XRET
######################################################################################
## Etiqueta añadida por el supervisor (pantalla BPC1) 03/05/2022 21:40:10 (ADMIN)
######################################################################################
Subprog AM_ZFACM(VALEUR)
Variable Integer VALEUR
[M:BPC1]ZFACDAT=date$
Affzo [M:BPC1]ZFACDAT
End

Subprog AM_ZFACP(VALEUR)
Variable Integer VALEUR
[M:BPC1]ZFACDAT=date$
Affzo [M:BPC1]ZFACDAT
End

#06.364.489.INI
######################################################################################
######################################################################################
## Etiqueta añadida por el supervisor (pantalla BPC0) 31/08/2022 10:00:07 (ADEV)
######################################################################################
Subprog AM_BCGCOD(VALEUR)
Variable Char    VALEUR()
#NAC --> NIF ; EXP -->Otros ; CEE-->Nif intracomunitario
If VALEUR="NAC" Then
  [M:BPRC]DOCTYP=1
Elsif VALEUR="EXP" Then
  [M:BPRC]DOCTYP=6
Elsif VALEUR="CEE" Then
  [M:BPRC]DOCTYP=2
Endif
#Actualizamos la máscara de la pantalla
Affzo[M:BPRC]DOCTYP

End

######################################################################################
##06.364.489.FIN
######################################################################################
## Etiqueta añadida por el supervisor (pantalla BPC0) 31/08/2022 11:47:30 (ADEV)
######################################################################################
Subprog AP_BCGCOD(VALEUR)
Variable Char    VALEUR()
End


######################################################################################
